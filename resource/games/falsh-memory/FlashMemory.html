<html>
<head>
<title>闪存记忆</title>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
<link href="../base.css" rel="stylesheet" type="text/css" media="screen">
<style>
body{background-color:#ccc}
.game-ctn{
	margin:auto;position:relative;width:500px;height:400px;background-color:#fff;padding:2px;
}
.game-result{
	margin:auto;position:relative;width:200px;height:30px;border:1px solid black;font-size:20px;font-weight:bold;text-align:center;
}
.game-block{
	position:absolute;width:40px;height:40px;font-size:36px;font-weight:bold;text-align:center;border:2px solid #ccc;cursor:pointer
}
</style>
<script type="text/javascript">
</script>
</head>

<body>
<div>
说明：点击<button type=button onclick="playGame();" style="font-size:16px;">开始</button>后，会出现一系列数字，两秒后数字消失，之后按大小顺序点击数字所在区域，即可得分
</div>
<hr/>
<div style="text-align:center;">
<div class="game-result" id="game-result" style="visibility:hidden;">&nbsp;</div>
<div class="game-ctn" id="game-ctn" >
</div>
&nbsp;
</div>
<div>您的最高得分：<input id=highScore readonly style="width:100px;"> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
您的目前得分：<input id=curScore readonly style="width:100px;"></div>
<div>您的得分历史：<textarea id=hisScore readonly style="width:500px;height:60px;"></textarea></div>
</div>



<script>
function $(id){
	return document.getElementById(id);
}

$("game-ctn").onmousedown=ctn_click;
$("game-ctn").onselect=function(){return false;};
function getRandomPlayCard(m) //洗牌
{
	var array1=new Array(m);
	for(var i=0;i<m;i++){
		var rnd=Math.floor(Math.random()*(i+0.999))
		array1[i]=array1[rnd];
		array1[rnd]=i;
	}
	return array1;
}

var scores=[];
var highScore=0;
var currentN=3;
var blockHTML='<div class="game-block"></div>';
var timer=0;
var isReady=false;
function playGame(){
	scores=[];
	highScore=0;
	currentN=3;
	$("highScore").value=0;
	$("curScore").value=0;
	$("hisScore").value="";
	window.clearTimeout(timer);
	stepBegin();
}

function stepBegin(){
	$("game-ctn").innerHTML=new Array(Math.min(currentN+1,11)).join(blockHTML);
	var els=$("game-ctn").childNodes;
	var cards=getRandomPlayCard(10);
	for(var i=0;i<els.length;i++){
		var elI=els[i];
		var posI=[Math.random()*450,Math.random()*350];
		for(var j=0;j<i;j++){
			var posJ=[parseInt(els[j].style.left),parseInt(els[j].style.top)];
			if(Math.abs(posI[0]-posJ[0])<40 && Math.abs(posI[1]-posJ[1])<40){
				posI=[Math.random()*450,Math.random()*350];
				i--;
				break;
			}
		}
		elI.innerHTML=els[i].value=cards[i];
		elI.style.left=posI[0]+"px";
		elI.style.top=posI[1]+"px";
	}
	isReady=false;
	timer=setTimeout(stepReady,1000);
	$("game-result").style.visibility="hidden";
}

function stepReady(){
	clearTimeout(timer);
	var els=$("game-ctn").childNodes;
	for(var i=0;i<els.length;i++) els[i].innerHTML='';
	isReady=true;
}

function ctn_click(e){
	e=e||window.event;
	var el=e.srcElement || e.target;
	if(isReady && el.className=="game-block"){
		var els=$("game-ctn").childNodes;
		el.innerHTML=el.value;
		var rlt=true;
		for(var i=0;i<els.length;i++){
			if(!els[i].innerHTML && els[i].value<el.value) {
				//alert([els[i].value,el.innerHTML]);
				rlt=false;
				break;
			}
		}
		if (!rlt){
			$("game-result").style.visibility="";
			$("game-result").innerHTML="点错啦。";
			if(currentN>3) currentN--;
			window.clearTimeout(timer);
			setTimeout(stepBegin,1000);
			for(var i=0;i<els.length;i++) els[i].innerHTML=els[i].value;
			addScoreItem(0)
			isReady=false;
			return false;
		}
		
		var allOk=0;
		for(var i=0;i<els.length;i++){
			if(els[i].innerHTML) {
				allOk++;
			}
		}
		if(allOk==els.length){
			$("game-result").style.visibility="";
			$("game-result").innerHTML="正确。";
			currentN=els.length;
			addScoreItem(currentN);
			if(currentN<10) currentN++;
			isReady=false;
			window.clearTimeout(timer);
			setTimeout(stepBegin,1000);
		}
	}
	return false;
}
function addScoreItem(n){
	//return false;
	scores.push(n);
	var num=0,myScore=0;
	for(var i=scores.length-1;i>-1 && num<5;i--){
		if(scores[i]){
			myScore+=scores[i];
			num++;
		}
	}
	if(highScore<myScore) highScore=myScore;
	$("highScore").value=highScore*2;
	$("curScore").value=myScore*2;
	$("hisScore").value=scores;
	
};

</script>

</body>
</html>
